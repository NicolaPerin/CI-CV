# CI-CV: Automated CV Pipeline

A Jenkins CI/CD pipeline that automatically builds multiple variants of a CV using [RenderCV](https://github.com/rendercv/rendercv), containerized with [Podman](https://podman.io/).

## Overview

This project automates the generation of CV variants in different languages and with/without a photo. Jenkins periodically polls the repository for changes and, when new commits are detected, triggers a pipeline that builds all variants in parallel.

### Generated Variants

| Variant | Description |
|---------|-------------|
| `en-with-photo` | English CV with photo |
| `en-no-photo` | English CV without photo |
| `it-with-photo` | Italian CV with photo |
| `it-no-photo` | Italian CV without photo |

## Project Structure
```
.
├── cv/
│   ├── base.yaml              # Core identity + design settings
│   ├── overlays/
│   │   ├── photo.yaml         # Photo configuration
│   │   ├── lang-en.yaml       # English locale + GDPR statement
│   │   ├── lang-it.yaml       # Italian locale + GDPR statement
│   │   ├── content-en.yaml    # English CV content
│   │   └── content-it.yaml    # Italian CV content
│   └── scripts/
│       └── build.sh           # Build script executed inside container
├── Dockerfile                 # Container image definition
├── Jenkinsfile                # Pipeline definition
└── README.md
```

## How It Works

1. **Jenkins** triggers the pipeline on push
2. **Podman** builds a container image with RenderCV and dependencies
3. A **matrix build** runs 4 parallel jobs (2 languages × 2 photo options)
4. Each job:
   - Merges the appropriate YAML overlays using `yq`
   - Substitutes environment variables (secrets) using `envsubst`
   - Renders the CV using RenderCV
5. **PDF artifacts** are archived in Jenkins

The output filename is automatically derived from `CV_NAME` (e.g., "John Doe" → `John_Doe_CV.pdf`).

## Prerequisites

- Jenkins with Pipeline and Credentials plugins
- Podman installed on the Jenkins agent
- Git repository access

## Setup

### 1. Jenkins Credentials

Create the following credentials in Jenkins (Manage Jenkins → Credentials):

| Credential ID | Type | Description |
|---------------|------|-------------|
| `CV_NAME` | Secret text | Your full name (also used to generate the PDF filename) |
| `CV_LOCATION` | Secret text | Your location (e.g., "Trieste, Italy") |
| `CV_EMAIL` | Secret text | Your email address |
| `CV_PHONE` | Secret text | Your phone number (e.g., "+39 123456789") |
| `CV_BIRTHDAY` | Secret text | Your birthday (e.g., "01/01/1990") |
| `CV_PHOTO` | Secret file | Your profile photo (JPEG) |

### 2. Jenkins Pipeline Job

1. Create a new Pipeline job in Jenkins
2. Under "Pipeline", select "Pipeline script from SCM"
3. Configure your Git repository URL
4. Set "Script Path" to `Jenkinsfile`

### 3. Repository Setup

Clone this repository and customize:

1. **Edit `cv/overlays/content-en.yaml`** with your English CV content
2. **Edit `cv/overlays/content-it.yaml`** with your Italian CV content
3. **Edit `cv/base.yaml`** to adjust design settings if needed

## Configuration

### Adding a New Language

1. Create `cv/overlays/lang-XX.yaml` with locale settings
2. Create `cv/overlays/content-XX.yaml` with translated content
3. Add the language code to the Jenkinsfile matrix:
```groovy
axis {
    name 'LANG'
    values 'en', 'it', 'XX'  // Add new language here
}
```

### Customizing Design

Edit `cv/base.yaml` to modify:

- Page size and margins
- Colors
- Typography (fonts, sizes)
- Section title styles
- Entry templates

Refer to the [RenderCV documentation](https://docs.rendercv.com/) for all available options.

### Environment Variables

The following placeholders in YAML files are substituted at build time:

| Variable | Source | Used For |
|----------|--------|----------|
| `${CV_NAME}` | Jenkins credential | Name in CV + PDF filename |
| `${CV_LOCATION}` | Jenkins credential | Location in CV |
| `${CV_EMAIL}` | Jenkins credential | Email in CV |
| `${CV_PHONE}` | Jenkins credential | Phone in CV |
| `${CV_BIRTHDAY}` | Jenkins credential | Birthday in CV |
| `${PHOTO_FILE}` | Generated by pipeline | Photo path |

## Local Development

You can test the build locally without Jenkins:
```bash
# Set environment variables
export CV_NAME="Your Name"
export CV_LOCATION="Your City"
export CV_EMAIL="your@email.com"
export CV_PHONE="+1234567890"
export CV_BIRTHDAY="01/01/1990"
export PHOTO_FILE="profile_picture.jpg"

# Copy your photo
cp your_photo.jpg profile_picture.jpg

# Build the container
podman build -t rendercv-builder .

# Run a build
podman run --rm \
    -v $(pwd):/cv:Z \
    -e CV_NAME -e CV_LOCATION -e CV_EMAIL \
    -e CV_PHONE -e CV_BIRTHDAY -e PHOTO_FILE \
    rendercv-builder \
    bash cv/scripts/build.sh en with-photo
```

Output will be in `rendercv_output/en-with-photo/Your_Name_CV.pdf`.

## Artifacts

After a successful build, PDFs are available in Jenkins under "Build Artifacts".

The filename is derived from `CV_NAME` with spaces replaced by underscores:
```
rendercv_output/
├── en-with-photo/
│   └── <Your_Name>_CV.pdf
├── en-no-photo/
│   └── <Your_Name>_CV.pdf
├── it-with-photo/
│   └── <Your_Name>_CV.pdf
└── it-no-photo/
    └── <Your_Name>_CV.pdf
```

## Acknowledgements

This project is built with:

- **[RenderCV](https://github.com/rendercv/rendercv)** - A LaTeX/Typst-based CV generator with YAML input. RenderCV makes it easy to create professional CVs with version control.

- **[Jenkins](https://www.jenkins.io/)** - The leading open-source automation server, used here to orchestrate the CI/CD pipeline.

- **[Podman](https://podman.io/)** - A daemonless container engine for developing, managing, and running OCI Containers. Used to ensure reproducible builds.

- **[yq](https://github.com/mikefarah/yq)** - A lightweight YAML processor, used to merge overlay files.

## License

The pipeline code (Jenkinsfile, Dockerfile, build scripts) is licensed under the [MIT License](LICENSE).

**Note:** The CV content files (`content-en.yaml`, `content-it.yaml`) contain personal information and are not licensed for reuse.